<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multiplayer VR Room</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <a-scene>
    <a-entity id="camera" camera position="0 1.6 3" wasd-controls look-controls></a-entity>
    <a-plane position="0 0 -5" rotation="-90 0 0" width="20" height="20" color="#7BC8A4"></a-plane>
    
    <!-- Webcam Screen -->
    <a-plane id="webcamScreen" position="0 2 -4" rotation="0 0 0" width="4" height="2" material="side: double; shader: flat;"></a-plane>
  </a-scene>

  <script>
    const socket = io();

    // Access the webcam
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(function(stream) {
        const video = document.createElement('video');
        video.srcObject = stream;
        video.autoplay = true;

        video.onloadedmetadata = () => {
          const webcamScreen = document.querySelector('#webcamScreen');
          webcamScreen.setAttribute('material', 'src', video);
        };
      })
      .catch(function(error) {
        console.error('Error accessing the webcam: ', error);
      });

    // Handle user movement and position updates
    document.querySelector('#camera').addEventListener('componentchanged', () => {
      const position = document.querySelector('#camera').object3D.position;
      socket.emit('updatePosition', { position: { x: position.x, y: position.y, z: position.z } });
    });

    socket.on('userMoved', (data) => {
      // Create or update other users' entities
      let userEntity = document.getElementById(data.id);
      if (!userEntity) {
        userEntity = document.createElement('a-sphere');
        userEntity.setAttribute('id', data.id);
        userEntity.setAttribute('position', `${data.position.x} ${data.position.y} ${data.position.z}`);
        userEntity.setAttribute('radius', '0.2');
        userEntity.setAttribute('color', '#00FF00'); // Different color for other users
        document.querySelector('a-scene').appendChild(userEntity);
      } else {
        userEntity.setAttribute('position', `${data.position.x} ${data.position.y} ${data.position.z}`);
      }
    });
  </script>
</body>
</html>
