<!-- public/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Multiplayer VR Sample</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <!-- Ensure the socket.io script loads from the correct path -->
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <a-scene>
        <!-- Player template -->
        <a-entity id="player" position="0 1.6 0">
            <a-camera></a-camera>
        </a-entity>
        <!-- Ground -->
        <a-plane rotation="-90 0 0" width="30" height="30" color="#7BC8A4"></a-plane>
    </a-scene>

    <script>
        // Connect to socket.io using the current window location
        const socket = io(window.location.origin);

        let players = {};
        const player = document.getElementById('player');
        const camera = player.querySelector('a-camera');

        // Receive current players when joining
        socket.on('currentPlayers', (currentPlayers) => {
            players = currentPlayers;
            Object.keys(players).forEach(id => {
                if (id !== socket.id) addPlayer(id, players[id]);
            });
        });

        // Add new player
        socket.on('newPlayer', (data) => addPlayer(data.id, data.position));

        // Remove player
        socket.on('removePlayer', (id) => {
            const player = document.getElementById(id);
            if (player) player.remove();
        });

        // Move existing player
        socket.on('move', (data) => {
            const otherPlayer = document.getElementById(data.id);
            if (otherPlayer) {
                otherPlayer.setAttribute('position', data.position);
            }
        });

        // Helper to add a player
        function addPlayer(id, position) {
            const el = document.createElement('a-sphere');
            el.setAttribute('id', id);
            el.setAttribute('position', position);
            el.setAttribute('radius', 0.3);
            el.setAttribute('color', '#FF0000');

            // Create a text element to display the player's name
            const nameEl = document.createElement('a-text');
            nameEl.setAttribute('value', id); // Set the player's ID as the name
            nameEl.setAttribute('position', '0 0.5 0'); // Position above the sphere
            nameEl.setAttribute('color', '#FFFFFF');

            el.appendChild(nameEl);
            document.querySelector('a-scene').appendChild(el);
        }

        // Function to update the player's position based on camera
        function updatePlayerPosition() {
            const pos = camera.getAttribute('position'); // Get the camera position
            player.setAttribute('position', pos); // Update player entity's position
            sendMove(pos); // Send new position to server
        }

        // Send movement data
        function sendMove(position) {
            socket.emit('move', { position: position });
        }

        // Update position every 100 milliseconds
        setInterval(updatePlayerPosition, 100);
    </script>
</body>
</html>
