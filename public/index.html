<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VR Multiplayer App</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <style>
        body { margin: 0; }
        a-scene { width: 100vw; height: 100vh; }
    </style>
</head>
<body>
    <a-scene>
        <a-entity id="player" position="0 1.6 0" geometry="primitive: sphere; radius: 0.2" material="color: blue"></a-entity>
    </a-scene>

    <script>
        const socket = io(); // Connect to the server

        const playerEl = document.getElementById('player');

        socket.on('currentPlayers', (currentPlayers) => {
            for (const id in currentPlayers) {
                addPlayer(id, currentPlayers[id]);
            }
        });

        socket.on('newPlayer', (data) => {
            addPlayer(data.id, data.position);
        });

        socket.on('removePlayer', (id) => {
            removePlayer(id);
        });

        socket.on('move', (data) => {
            const player = document.getElementById(data.id);
            if (player) {
                player.setAttribute('position', data.position);
            }
        });

        function addPlayer(id, position) {
            const newPlayer = document.createElement('a-entity');
            newPlayer.setAttribute('id', id);
            newPlayer.setAttribute('geometry', 'primitive: sphere; radius: 0.2');
            newPlayer.setAttribute('material', 'color: red');
            newPlayer.setAttribute('position', position);
            document.querySelector('a-scene').appendChild(newPlayer);
        }

        function removePlayer(id) {
            const player = document.getElementById(id);
            if (player) {
                document.querySelector('a-scene').removeChild(player);
            }
        }

        document.addEventListener('keydown', (event) => {
            const moveDistance = 0.1;
            const position = playerEl.getAttribute('position');

            switch (event.key) {
                case 'ArrowUp':
                    position.z -= moveDistance;
                    break;
                case 'ArrowDown':
                    position.z += moveDistance;
                    break;
                case 'ArrowLeft':
                    position.x -= moveDistance;
                    break;
                case 'ArrowRight':
                    position.x += moveDistance;
                    break;
            }
            playerEl.setAttribute('position', position);
            // Send updated position to server
            socket.emit('move', { id: playerEl.id, position: position });
        });
    </script>
</body>
</html>
